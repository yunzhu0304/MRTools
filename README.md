# MRTools: Tools for Master Regulator Network Pruning and Annotation

---

## 📚Overview

**MRTools** is an R package designed for researchers in systems biology and transcriptomics to **prune and annotate master regulator (MR) networks** exported from **GeneXplain**.

The package integrates differential expression data (DEG), GeneXplain MR network files, and curated transcription factor lists (from：TFLink) to systematically:

- **Standardize gene symbols** according to species.
- **Prune redundant branches** from the GeneXplain MR network.
- **Annotate pruned genes** with DEG status (up, down, stable).
- **Classify nodes as transcription factors (TF) or others**.

The result is a cleaned and annotated MR network ready for downstream mechanistic interpretation and visualization.

---

## 🏗️Installation

To install and load the MRTools package, use the following commands:

```r
# Install the HyDDG package from GitHub 

if (!require("devtools", quietly = TRUE))
    install.packages("devtools")
    
devtools::install_github("yunzhu0304/MRTools")

# Load the package
library(MRTools)
```

---

## 📌Input Requirements

MRTools requires three main input datasets:

1. **DEG List (`DEG_data`)**
    
    A data frame with at least the following columns:
    
    - `GeneSymbol`: Gene identifier.
    - `logFC`: Log2 fold change.
    - `pval` or `adj.P.Val`: p-value or adjusted p-value.
    - `change`: Classified status ("up", "down", "stable") generated by `DEG_fit()`.
2. **GeneXplain MR Network (`GeneXplain_file`)**
    
    A data frame exported from GeneXplain, containing two columns:
    
    - `Source`: Regulator gene.
    - `Target`: Target gene.
3. **TFLink Data (`TF_Homo`, `TF_Mm`, `TF_Rn`)**
    
    Curated transcription factor lists provided within MRTools, used by `get_TFlist()`.
    

---

## 📏Main Functions

### 📍1. `DEG_fit`

Formats raw DEG results and applies thresholds to classify genes as “up”, “down”, or “stable”.

**Parameters**:

- `data`: DEG table.
- `GeneSymbol`: Column name for gene IDs.
- `logFC_from`: Column name for logFC values.
- `Pvalue_from`: Column name for p-values.
- `logFC_THR`: Log fold-change cutoff (default 1).
- `P.Value_THR`: p-value cutoff (default 0.05).

**Example**:

```r
data("DEG_demo")
DEG_list <- DEG_fit(
  data = DEG_demo,
  GeneSymbol = "GeneSymbol",
  logFC_from = "logFC",
  Pvalue_from = "adj.P.Val"
)
```

---

### 📊2. `convert_case`

Standardizes gene name case according to species.

- `Homo`: All uppercase (e.g., TP53).
- `Mm` / `Rn`: First letter uppercase, rest lowercase (e.g., Trp53).

**Example**:

```r
data("GeneXplain_source_target")
GeneXplain_norm <- convert_case(GeneXplain_source_target, species = "Homo")
```

---

### 📊3. `get_TFlist`

Loads the appropriate TF list (`TF_Homo`, `TF_Mm`, or `TF_Rn`) from the package.

**Example**:

```r
tf_human <- get_TFlist("Homo")
head(tf_human)
```

---

### 📊4. `MRTools`

The **main function**. Prunes the GeneXplain MR network based on DEG information and annotates remaining genes with TF status.

**Parameters**:

- `DEG_data`: Output from `DEG_fit()`.
- `GeneXplain_file`: GeneXplain source-target data.
- `GXP_source`, `GXP_target`: Column names for Source and Target.
- `species`: Species name ("Homo", "Mm", "Rn").

**Example**:

```r
MRTools_result <- MRTools(
  DEG_data = DEG_list,
  GeneXplain_file = GeneXplain_source_target,
  GXP_source = "Source",
  GXP_target = "Target",
  species = "Homo"
)
```

**Output**: An object of class `MRToolsResult`, containing:

- `MR_list`: The pruned MR network (Source → Target edges).
- `MRgene_property`: Annotated gene table with DEG status and TF classification.

---

### 📊5. `MRToolsToCytoscape`

Exports the pruned and annotated MR network into **Cytoscape** for interactive visualization.

It creates a network from the pruned Source–Target edges and applies visual styles:

- **Node color**: mapped to logFC (blue → white → red).
- **Node shape**: TF vs. Others (diamond vs. rectangle).
- **Node labels**: gene IDs, adjustable font size and font face.
- **Node size**: customizable height and width.

⚠️ **Important**: Before running this function, ensure that Cytoscape is installed and running on your local computer. Wait until Cytoscape shows

`Automation API listening on port 1234` in its console window.

**Parameters**:

- `MRTResult`: Output from `MRTools()`, i.e. an object of class `MRToolsResult`.
- `title`: Network title in Cytoscape (default: `"MRTools Network"`).
- `collection`: Cytoscape network collection name (default: `"MRTools"`).
- `shap_col`: Column to define node shape (default: `"If_TF"`).
- `NODE_LABEL_FONT_SIZE`: Label font size (default: `45`).
- `NODE_HEIGHT`: Node height (default: `60`).
- `NODE_WIDTH`: Node width (default: `120`).
- `NODE_LABEL_FONT_FACE`: Font face for labels (default: `"Arial Rounded MT Bold"`).

**Example**:

```r
# Ensure Cytoscape is open locally before running
MRToolsToCytoscape(MRTResult = MRTools_result)
```

## 🧭Recommended Workflow

```r
# Step 1: Format DEG list
data("DEG_demo")
DEG_list <- DEG_fit(DEG_demo, "GeneSymbol", "logFC", "adj.P.Val")

# Step 2: Load GeneXplain export file
data("GeneXplain_source_target")

# Step 3:  Run MRTools pruning
MRTools_result <- MRTools(
  DEG_data = DEG_list,
  GeneXplain_file = GeneXplain_source_target,
  GXP_source = "Source",
  GXP_target = "Target",
  species = "Rn"
)

# Step 4: Inspect results
head(MRTools_result$MR_list)
head(MRTools_result$MRgene_property)

# Step 5: Visualize in Cytoscape
# Ensure Cytoscape is open locally before running:
MRToolsToCytoscape(MRTResult = MRTools_result)
```

---

## 📝Example Output

### <img width="1673" height="962" alt="image" src="https://github.com/user-attachments/assets/4c7aeda6-44ab-4c3b-aef3-7456218fef73" />


---

## ⚠️Notes

## 📖References

- Zhu, Y. & Xu, Y. (2025). MRTools: An R package for pruning and annotating master regulator networks. *(in preparation)*.

---

## ☎️Contact

For questions or issues, please contact the package maintainers:

- **Zhu Yun** (Zhu.Yun@mh-hannover.de)
- **Xu Yanzhe** (Xu.Yanzhe@mh-hannover.de)

GitHub Repository: https://github.com/yunzhu0304/MRTools
